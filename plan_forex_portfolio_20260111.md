# Implementation Plan: Forex & Commodities Portfolio (AUD)

**Plan ID:** plan_forex_portfolio_20260111
**Created:** 2026-01-11 13:15
**Author:** Gemini CLI (Plan Mode)
**Status:** ‚úÖ IMPLEMENTED
**Completed:** 2026-01-11 14:35
**Estimated Complexity:** Medium
**Estimated Phases:** 3

---

## üìã Executive Summary
This plan implements a dedicated Forex & Commodities portfolio section. Users can add trades using OANDA symbols (e.g., XAG_USD), entering the quantity and the trade price in the pair's native currency. The system will automatically calculate and display the unrealized and realized profit/loss in **AUD** using real-time conversion rates from OANDA data.

---

## üîç Analysis

### Codebase Exploration
- **Backend API:** New `forex_portfolio.py` mirroring the structure of `portfolio.py` but simplified (no tax/brokerage).
- **Data Source:** `forex_signals.json` (generated by `ForexScreener`) will be the primary source for current prices and AUD conversion rates.
- **Frontend UI:** `Portfolio.jsx` will be refactored to include a toggle between "ASX Stocks" and "Forex & Commodities".

### Key Logic: AUD Conversion
1. **P/L in Quote Currency:** `(Current Price - Entry Price) * Quantity`.
2. **AUD Conversion:** If the pair is `XAG_USD`, the P/L is in USD. We fetch the `AUD_USD` rate from OANDA data to convert the USD profit into AUD.
3. **Display:** All totals and individual items show AUD values.

---

## ‚úÖ Implementation Plan

### Phase 1: Backend API (OANDA & AUD)
**Objective:** Create Firestore-backed API endpoints for Forex trades with AUD conversion logic.
**Complexity:** Medium

#### Tasks:
- [x] **Task 1.1: Create Forex Portfolio Models** ‚úÖ [2026-01-11 13:35]
  - **Files:** `backend/app/models/forex_portfolio_schema.py`
  - **Action:** Create. Define `ForexPortfolioItemCreate` and `ForexPortfolioItemResponse` (symbol, buy_price, quantity, status).
- [x] **Task 1.2: Implement Forex Portfolio Router** ‚úÖ [2026-01-11 13:40]
  - **Files:** `backend/app/api/forex_portfolio.py`
  - **Action:** Create. Implement GET (list), POST (add), PUT (update), DELETE (remove), and POST (sell).
  - **Details:** 
    - Fetch current prices from `processed/forex_signals.json`.
    - Perform AUD conversion for P/L calculations.
    - Use Firestore collection `forex_portfolio`.
- [x] **Task 1.3: Register Router** ‚úÖ [2026-01-11 13:42]
  - **Files:** `backend/app/api/routes.py`
  - **Action:** Modify. Include `forex_portfolio.router`.

---

### Phase 2: Frontend "Add to Portfolio"
**Objective:** Enable adding Forex/Commodity trades directly from the screener.
**Complexity:** Simple

#### Tasks:
- [x] **Task 2.1: Create AddForexModal** ‚úÖ [2026-01-11 13:45]
  - **Files:** `frontend/src/components/AddForexModal.jsx`
  - **Action:** Create. Input fields for OANDA Symbol, Entry Price, and Units/Quantity.
- [x] **Task 2.2: Update ForexCard** ‚úÖ [2026-01-11 13:50]
  - **Files:** `frontend/src/components/ForexCard.jsx`
  - **Action:** Modify. Add an "Add to Portfolio" button.
- [x] **Task 2.3: App Integration** ‚úÖ [2026-01-11 13:55]
  - **Files:** `frontend/src/App.jsx`
  - **Action:** Modify. Add state to handle opening `AddForexModal` from the Forex list.

---

### Phase 3: Portfolio Dashboard (AUD View)
**Objective:** Display active and closed Forex trades with AUD P/L.
**Complexity:** Medium

#### Tasks:
- [x] **Task 3.1: Asset Class Toggle** ‚úÖ [2026-01-11 14:05]
  - **Files:** `frontend/src/components/Portfolio.jsx`
  - **Action:** Modify. Add a high-level toggle: `[ ASX STOCKS ] [ FOREX & COMMODITIES ]`.
- [x] **Task 3.2: Forex Holdings Table** ‚úÖ [2026-01-11 14:15]
  - **Files:** `frontend/src/components/Portfolio.jsx`
  - **Action:** Implement a table for Forex showing: Symbol (OANDA), Entry, Current, Qty, and AUD P/L.
- [x] **Task 3.3: Sell Forex Logic** ‚úÖ [2026-01-11 14:20]
  - **Files:** `frontend/src/components/SellForexModal.jsx`
  - **Action:** Create. Allow entering exit price and date.
- [x] **Task 3.4: Closed Trades Section** ‚úÖ [2026-01-11 14:30]
  - **Files:** `frontend/src/components/Portfolio.jsx`
  - **Action:** Implement a simplified "Closed History" for Forex showing AUD Gain/Loss and % Profit. Show a grand total for all closed forex trades.

---

## üìä Task Summary
| Phase | Tasks | Complexity | Status |
|-------|-------|------------|--------|
| Phase 1: Backend | 3 | Medium | ‚úÖ Completed |
| Phase 2: Screener | 3 | Simple | ‚úÖ Completed |
| Phase 3: Portfolio UI | 4 | Medium | ‚úÖ Completed |
| **Total** | **10** | - | - |

---

## üîÑ Rollback Strategy
- Revert `App.jsx` and `Portfolio.jsx` to original state.
- Delete `backend/app/api/forex_portfolio.py`.

---

## üìù Notes
- Standardizing to AUD ensures the user sees a consistent value regardless of the pair traded.
- No tax or brokerage logic will be applied to Forex items as per user request.
